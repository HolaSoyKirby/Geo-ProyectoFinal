<!DOCTYPE html>
<html>

<head>
    <title>Proyecto Final</title>

    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
        
    </style>
    <link rel="stylesheet" href="./css/mapa.css" />
</head>

<body>
    <div id="map"></div>
    <script>
        let aviones = [];
        let coordenadas = {
            lat: 23.289674,
            lng: -101.793495
        };

        let limites = {
            north: 50,
            south: -5,
            west: -159,
            east: -54,
        };

        let propiedades = {
            center: coordenadas,
            zoom: 5,
            restriction: {
                latLngBounds: limites,
                strictBounds: false,
            },
        }

        async function iniciaMapa() {
            const map = new google.maps.Map(document.getElementById('map'), propiedades);
            map.setOptions({
                minZoom: 5
            });

            const centerControlDiv = document.createElement("div");
            centerControl(centerControlDiv, map);

            map.controls[google.maps.ControlPosition.TOP_CENTER].push(centerControlDiv);

            const uri =
                "https://opensky-network.org/api/states/all?lamin=12.754424&lomin=-127.415227&lamax=32.720980&lomax=-86.76";
            const res = await fetch(uri);
            const data = await res.json();

            aviones = filtrarAviones(data.states);

            aviones.forEach((element, index) => {
                let latLng = new google.maps.LatLng(element[6], element[5]); //Makes a latlng

                let marker = new google.maps.Marker({
                    map: map,
                    position: latLng,
                    title: `${index} ${element[2]}`,
                    icon: {
                        url: `http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|${randomColor()}`
                    }
                });

                marker.addListener('click', () => {
                    map.panTo(latLng); //Make map global
                    map.setZoom(8);
                });
            });
        }

        
    </script>
    <script src="./js/randomColor.js"></script>
    <script src="./js/filtrarAviones.js"></script>
    <script src="./js/mapaController.js"></script>

    <!-- Google Maps -->
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCklgR88CgKokH7bIKeOy1EVmVVHuq4tXo&callback=iniciaMapa"
        async defer></script>
</body>

</html>