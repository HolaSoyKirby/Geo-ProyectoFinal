<!DOCTYPE html>
<html>

<head>
    <title>Proyecto Final</title>

    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
        #map {
            height: 100%;
        }

        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <script>
        var aviones = [];
        var coordenadas = {
            lat: 23.289674,
            lng: -101.793495
        }

        var propiedades = {
            center: coordenadas,
            zoom: 5
        }

        async function iniciaMapa() {
            const map = new google.maps.Map(document.getElementById('map'), propiedades);
            
            const uri =
                "https://opensky-network.org/api/states/all?lamin=12.754424&lomin=-127.415227&lamax=32.720980&lomax=-86.76";
            const res = await fetch(uri);
            const data = await res.json();

            const avionazos = data.states;
            for (let element of avionazos) {

                let m1, m2;

                if (element[5] <= -114.719231) {
                    aviones.push(element);
                } else if (element[5] > -114.719231 && element[5] <= -111.077301) {
                    let lat1 = 32.720980,
                        lat2 = 31.337595,
                        lon1 = -114.719231,
                        lon2 = -111.077301;
                    m1 = (lat2 - lat1) / (lon2 - lon1);
                    m2 = (lat2 - element[6]) / (lon2 - element[5]);

                    if (m2 >= m1) {
                        aviones.push(element);
                    }
                } else if (element[5] > -111.077301 && element[5] <= -108.216421) {
                    let lat = 31.337595

                    if (element[6] <= lat) {
                        aviones.push(element);
                    }
                } else if (element[5] > -108.216421 && element[5] <= -106.186345) {
                    let lat = 31.816997;

                    if (element[6] <= lat) {
                        aviones.push(element);
                    }
                } else if (element[5] > -106.186345 && element[5] <= -103.653327) {
                    let lat1 = 31.816997,
                        lat2 = 29.884509,
                        lon1 = -106.186345,
                        lon2 = -103.653327;
                    m1 = (lat2 - lat1) / (lon2 - lon1);
                    m2 = (lat2 - element[6]) / (lon2 - element[5]);

                    if (m2 >= m1) {
                        aviones.push(element);
                    }
                } else if (element[5] > -103.653327 && element[5] <= -101.079160) {
                    let lat = 29.884509;

                    if (element[6] <= lat) {
                        aviones.push(element);
                    }
                } else if (element[5] > -101.079160 && element[5] <= -97.785928) {
                    let lat1 = 29.884509,
                        lat2 = 26.513094,
                        lon1 = -101.079160,
                        lon2 = -97.785928;
                    m1 = (lat2 - lat1) / (lon2 - lon1);
                    m2 = (lat2 - element[6]) / (lon2 - element[5]);

                    if (m2 >= m1) {
                        aviones.push(element);
                    }
                } else if (element[5] > -97.785928 && element[5] <= -95.065192) {
                    let lat1 = 26.513094,
                        lat2 = 29.659108,
                        lon1 = -97.785928,
                        lon2 = -95.065192;
                    m1 = (lat2 - lat1) / (lon2 - lon1);
                    m2 = (lat2 - element[6]) / (lon2 - element[5]);

                    if (m2 >= m1) {
                        aviones.push(element);
                    }
                } else {
                    let lat = 29.463625;

                    if (element[6] <= lat) {
                        aviones.push(element);
                    }
                }
            }

            aviones.forEach((element, index) => {
                let latLng = new google.maps.LatLng(element[6], element[5]); //Makes a latlng
                
                let marker = new google.maps.Marker({
                    map: map,
                    position: latLng,
                    title: `${index} ${element[2]}`,
                    icon: {
                        url: `http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|${randomColor()}`
                    }
                });

                marker.addListener('click', () => {
                    map.panTo(latLng); //Make map global
                    map.setZoom(8);
                    }
                );
            });
        }

        function randomColor() {
            let letters = '0123456789ABCDEF';
            let color = '';
            for (var i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }
    </script>

    <!-- Google Maps -->
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCklgR88CgKokH7bIKeOy1EVmVVHuq4tXo&callback=iniciaMapa"
        async defer></script>
</body>

</html>